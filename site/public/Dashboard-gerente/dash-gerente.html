<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/dash.css">
    <link href='https://fonts.googleapis.com/css?family=Poppins' rel='stylesheet'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css"
        integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <title>Dashboard Gerente</title>
</head>

<body>
    <div class="container">
        <div class="navigation">
            <ul>
                <li>
                    <a href="#">
                        <span class="icon">
                            <ion-icon name="home"></ion-icon>
                        </span>
                        <span class="title">Totem System</span>
                    </a>
                </li>
                <li>
                    <a href="dash-gerente.html">
                        <span class="icon">
                            <ion-icon name="stats-chart"></ion-icon>
                        </span>
                        <span class="title">Gráficos</span>
                    </a>
                </li>
                <li>
                    <a href="adicionar.html">
                        <span class="icon">
                            <ion-icon name="person-add-outline"></ion-icon>
                        </span>
                        <span class="title">Adicionar Usuário</span>
                    </a>
                </li>
                <li>
                    <a href="https://totemsystem.freshdesk.com/support/home">
                        <span class="icon">
                            <i class="fa-solid fa-headset"></i>
                        </span>
                        <span class="title">Help Desk</span>
                    </a>
                </li>
                <li>
                    <a href="#" onclick="limparSessao()">
                        <span class="icon">
                            <ion-icon name="log-out"></ion-icon>
                        </span>
                        <span class="title">Sair</span>
                    </a>
                </li>
            </ul>
        </div>

        <div class="main">
            <div class="topbar">
                <div class="toggle">
                    <ion-icon name="menu-outline"></ion-icon>
                </div>
                <div class="user">
                    <img src="../assets/imgs/download.png" alt="">
                </div>
            </div>
            <div class="cardBox" id="cardTotem1" style="display: grid;">
                <div class="card">
                    <div>
                        <div class="numbers">Verde</div>
                        <div class="cardName">O totem está em suas perfeitas condições</div>
                        <br>
                        <div>
                            <div style="font-weight: bold;" class="cardName">Totens Funcionando</div>
                            <div id="kpi_totalTotemFuncionando" class="numbers">0</div>
                        </div>
                    </div>
                    <div class="iconBox">
                        <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="48" height="48"
                            viewBox="0 0 48 48">
                            <path fill="#4caf50"
                                d="M44,24c0,11.045-8.955,20-20,20S4,35.045,4,24S12.955,4,24,4S44,12.955,44,24z"></path>
                            <path fill="#ccff90"
                                d="M34.602,14.602L21,28.199l-5.602-5.598l-2.797,2.797L21,33.801l16.398-16.402L34.602,14.602z">
                            </path>
                        </svg>
                    </div>
                </div>
                <div class="card">
                    <div>
                        <div class="numbers">Amarelo</div>
                        <div class="cardName">Tome cuidado, algo de errado está por vir</div>
                        <br>
                        <div>
                            <div style="font-weight: bold;" class="cardName">Totens alerta</div>
                            <div id="kpi_totalTotemAlerta" class="numbers">0</div>
                        </div>
                    </div>
                    <div class="iconBox">
                        <img
                            src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAABmJLR0QA/wD/AP+gvaeTAAADiUlEQVRoge2ZTWhUVxTHf+clY147leCmo2JrCHUywXahDombgk33kWjrQtSVCE3FjXThQhTcCAG/0Iba5UClYk3rvnEhqE1GEaTMTBScFKkmG8UPOsH4jgsDxffu5H3mETC/3Zx77j3/w31z77n3whJLvN9IEoOoYlHOF1GrDygCeYQ1KNm5KC9RHqLUEG4hzijFibIITtzYsRLQcvcqlO9RZw/IJyG7/4NICeGcFCuPomqIlIBe+2IFba+OAvsAO2rwORrAeTL2Edlw52nYzqET0LHCNmAY+DhsXx+mgEHpqV4O0ylwAnqRFjoKJ4ADYZWFQ05TrxyUHbwO5B3ESa922GTtX4CBWNqCM8LLxk75qt7wc7T8HPQiLXxol0hPPMAAWftXvbql1c/RNwE6CicQvklEVjj6yT4a8nOa9xOa+8P+lpik8Cgq26W3MtLMoWkCWu5sx1lWAVZFibz5cNc7v28eq0UZBmCKmUy3fHn3iamx+Seky44RUXzC5Ob2HCPGBHRs/UqUvQunKTT79HbXalODeQbE2Q98sJCKQmLz2ho0NXgSUMVCdffCawqJo7tUvXq9M1DOF4FP09AUCmEtY10b3WZvAmp9nYqgSFh9HovBa1MKSqJhUfSavHQZbIsD1YLbZErAuFwtEjz7kimBj1IQEpXlboN/MbfIMSXwInUVwXnuNpgS+DcFIVHxHP5NB4Ya8HncSDGqz+aIVN0m0wzcSj5yQjiU3SZvAuL8mYqYSDijbovnQKOKxXjhAYutHlIm6al2um/zPDMggoNIKW686xNZ+oc66R/q5MZEAluLSMl0FWneB9Q6C/wXJ97xP3JMP8sw/SzD8Su5OEMBNGh1hk0NxgSk5+/HwM9xoyaH/CQba8blvflO7MwexrDuBuXQ1mly7bPk2mc5tPVx1GEApsi0NT0TB7lWueTnt4AoKtukt/J7M4d5a6G3F61yJnldAVFOzSceghRz9cpBlEuJiQrOFSarP/g5BbvcvfdZG09aL5De/ehlVszulHX3Z/wcA5XTsu7+DPXqt6CnAI0trzmKcpJ6dUcQ8RDlgeOv7gFEh4HYi7uLKVS+m+8e1EToA430VkbI2AXgDG+fh+LSADlNxi6EFQ9JPPI5DILuIWztpEwiUsLix9Qf+TxaFIvx/Ca0pQ+0iEUeZQ3/n69fIDzEYQJkHJxRemq3k3hmXWKJ9503x0/4rsA0qM0AAAAASUVORK5CYII=">
                    </div>
                </div>
                <div class="card">
                    <div>
                        <div class="numbers">Vermelho</div>
                        <div class="cardName">Seu totem está desativado ou um erro critíco</div>
                        <br>
                        <div>
                            <div style="font-weight: bold;" class="cardName">Totens Desativados</div>
                            <div id="kpi_totalTotemParado" class="numbers">0</div>
                        </div>
                    </div>
                    <div class="iconBox">
                        <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="48" height="48"
                            viewBox="0 0 48 48">
                            <path fill="#f44336"
                                d="M44,24c0,11.045-8.955,20-20,20S4,35.045,4,24S12.955,4,24,4S44,12.955,44,24z"></path>
                            <path fill="#fff" d="M29.656,15.516l2.828,2.828l-14.14,14.14l-2.828-2.828L29.656,15.516z">
                            </path>
                            <path fill="#fff" d="M32.484,29.656l-2.828,2.828l-14.14-14.14l2.828-2.828L32.484,29.656z">
                            </path>
                        </svg>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"> </script>
    <script script nomodule src="https://unpkg .com/ionicons@5.5.2/dist/ionicons/ionicons.js"> </script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="../graficos/chartbar.js"></script>
    <script src="../graficos/chartpolar.js"></script>

    <script>

        var idEstacao = sessionStorage.FK_EMPRESA;

        window.onload = function buscarTotem() {

            fetch(`/medidas/totem/${idEstacao}`).then(function (response) {
                if (response.ok) {
                    response.json().then(function (resposta) {
                        console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                        criarCard(resposta)
                    });
                } else {
                    console.error('Nenhum dado encontrado ou erro na API');
                }
            })
        }

        var totalTotensEstacao = 0;

        function criarCard(resposta) {
            for (let index = 0; index < resposta.length; index++) {
                totem = resposta[index].idTotem
                idEstacao = resposta[index].fkEstacao
                totalTotensEstacao++
                capturarDados(idEstacao);
            }
        }

        function capturarDados(idEstacao) {
            fetch(`/medidas/buscar-kpi/${idEstacao}`).then(function (response) {
                if (response.ok) {
                    response.json().then(function (resposta) {
                        console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                        console.log(resposta)
                        preencherKPI(resposta)
                        atualizarStatusTotem(resposta)
                    });

                } else {
                    console.error('Nenhum dado encontrado ou erro na API');
                }
            })

            setTimeout(() => capturarDados(idEstacao), 10000);
        }

        function atualizarStatusTotem(resposta) {
            for (let index = 0; index < resposta.length; index++) {
                totem = resposta[index].idTotem
                processadorUso = resposta[index].processadorUso
                totalDiscoDisponivel = resposta[index].memoriaDisponivel - resposta[index].memoriaTotal
                memoriaRamPorcentagem = resposta[index].memoriaRamDisponivel * (90 / 100)
                memoriaRamUso = resposta[index].memoriaRamUso

                if (processadorUso > 95 || totalDiscoDisponivel < 40 || memoriaRamUso >= memoriaRamPorcentagem) {
                    document.getElementById(`statusTotem${totem}`).innerHTML = `<div class="iconBox">
                <img
                    src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAABmJLR0QA/wD/AP+gvaeTAAADiUlEQVRoge2ZTWhUVxTHf+clY147leCmo2JrCHUywXahDombgk33kWjrQtSVCE3FjXThQhTcCAG/0Iba5UClYk3rvnEhqE1GEaTMTBScFKkmG8UPOsH4jgsDxffu5H3mETC/3Zx77j3/w31z77n3whJLvN9IEoOoYlHOF1GrDygCeYQ1KNm5KC9RHqLUEG4hzijFibIITtzYsRLQcvcqlO9RZw/IJyG7/4NICeGcFCuPomqIlIBe+2IFba+OAvsAO2rwORrAeTL2Edlw52nYzqET0LHCNmAY+DhsXx+mgEHpqV4O0ylwAnqRFjoKJ4ADYZWFQ05TrxyUHbwO5B3ESa922GTtX4CBWNqCM8LLxk75qt7wc7T8HPQiLXxol0hPPMAAWftXvbql1c/RNwE6CicQvklEVjj6yT4a8nOa9xOa+8P+lpik8Cgq26W3MtLMoWkCWu5sx1lWAVZFibz5cNc7v28eq0UZBmCKmUy3fHn3iamx+Seky44RUXzC5Ob2HCPGBHRs/UqUvQunKTT79HbXalODeQbE2Q98sJCKQmLz2ho0NXgSUMVCdffCawqJo7tUvXq9M1DOF4FP09AUCmEtY10b3WZvAmp9nYqgSFh9HovBa1MKSqJhUfSavHQZbIsD1YLbZErAuFwtEjz7kimBj1IQEpXlboN/MbfIMSXwInUVwXnuNpgS+DcFIVHxHP5NB4Ya8HncSDGqz+aIVN0m0wzcSj5yQjiU3SZvAuL8mYqYSDijbovnQKOKxXjhAYutHlIm6al2um/zPDMggoNIKW686xNZ+oc66R/q5MZEAluLSMl0FWneB9Q6C/wXJ97xP3JMP8sw/SzD8Su5OEMBNGh1hk0NxgSk5+/HwM9xoyaH/CQba8blvflO7MwexrDuBuXQ1mly7bPk2mc5tPVx1GEApsi0NT0TB7lWueTnt4AoKtukt/J7M4d5a6G3F61yJnldAVFOzSceghRz9cpBlEuJiQrOFSarP/g5BbvcvfdZG09aL5De/ehlVszulHX3Z/wcA5XTsu7+DPXqt6CnAI0trzmKcpJ6dUcQ8RDlgeOv7gFEh4HYi7uLKVS+m+8e1EToA430VkbI2AXgDG+fh+LSADlNxi6EFQ9JPPI5DILuIWztpEwiUsLix9Qf+TxaFIvx/Ca0pQ+0iEUeZQ3/n69fIDzEYQJkHJxRemq3k3hmXWKJ9503x0/4rsA0qM0AAAAASUVORK5CYII=">
            </div>`;
                } else {
                    document.getElementById(`statusTotem${totem}`).innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="48" height="48"
                    viewBox="0 0 48 48">
                    <path fill="#4caf50"
                        d="M44,24c0,11.045-8.955,20-20,20S4,35.045,4,24S12.955,4,24,4S44,12.955,44,24z"></path>
                    <path fill="#ccff90"
                        d="M34.602,14.602L21,28.199l-5.602-5.598l-2.797,2.797L21,33.801l16.398-16.402L34.602,14.602z">
                    </path>
                </svg>`;
                }
            }
        }

        function preencherKPI(resposta) {
            var totalTotemParado = 0;
            var totalTotemFuncionando = 0;
            var totalTotemAlerta = 0;

            for (let index = 0; index < resposta.length; index++) {
                totalDiscoDisponivel = resposta[index].memoriaDisponivel - resposta[index].memoriaTotal
                processaorUso = resposta[index].processadorUso
                memoriaRamPorcentagem = resposta[index].memoriaRamDisponivel * (90 / 100)
                memoriaRamUso = resposta[index].memoriaRamUso

                if (processaorUso > 95 || totalDiscoDisponivel < 40 || memoriaRamUso >= memoriaRamPorcentagem) {
                    totalTotemAlerta++
                    kpi_totalTotemAlerta.innerHTML = `${totalTotemAlerta}`;
                } else {
                    totalTotemFuncionando++
                    kpi_totalTotemFuncionando.innerHTML = `${totalTotemFuncionando}`;
                }

                if (totalTotensEstacao > resposta.length) {
                    totalTotemParado++
                    kpi_totalTotemParado.innerHTML = `${totalTotemParado}`;
                }
            }

            setTimeout(() => preencherKPI(idEstacao), 5000);
        }

        let toggle = document.querySelector('.toggle');
        let navigation = document.querySelector('.navigation');
        let main = document.querySelector('.main');

        toggle.onclick = function () {
            navigation.classList.toggle('active');
            main.classList.toggle('active');
        }

        let list = document.querySelectorAll(".navigation li");
        function activelink() {
            list.forEach((item) =>
                item.classList.remove('hovered'));
            this.classList.add('hovered');
        }
        list.forEach((item) =>
            item.addEventListener('mouseover', activelink));

        b_usuario.innerHTML = sessionStorage.NOME_USUARIO;

        function limparSessao() {
            sessionStorage.clear();
            window.location = "../login.html";
        }
    </script>
</body>

</html>